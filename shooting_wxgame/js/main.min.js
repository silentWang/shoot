var egret=window.egret,__reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(s,o){function a(t){try{h(i.next(t))}catch(e){o(e)}}function r(t){try{h(i["throw"](t))}catch(e){o(e)}}function h(t){t.done?s(t.value):new n(function(e){e(t.value)}).then(a,r)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(s)throw new TypeError("Generator is already executing.");for(;h;)try{if(s=1,o&&(a=o[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(o,n[1])).done)return a;switch(o=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,o=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(a=h.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){h=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){h.label=n[1];break}if(6===n[0]&&h.label<a[1]){h.label=a[1],a=n;break}if(a&&h.label<a[2]){h.label=a[2],h.ops.push(n);break}a[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(i){n=[6,i],o=0}finally{s=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var s,o,a,r,h={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return r={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r},StarBody=function(t){function e(){var e=t.call(this)||this;return e.mass=0,e.collisionResponse=!1,e.id=Constants.STAR_ID,e.position=[0,0],e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=utils.createBitmapByName("star_png");this.starSprite=new egret.Sprite,this.starSprite.addChild(t),this.starSprite.anchorOffsetX=this.starSprite.width/2,this.starSprite.anchorOffsetY=this.starSprite.height/2;var e=new p2.Circle({radius:this.starSprite.width/2/Constants.FACTOR});this.addShape(e),this.starShape=e,this.displays=[this.starSprite]},e.prototype.updatePosition=function(t,e){this.starSprite.x=t,this.starSprite.y=e,this.position[0]=this.starSprite.x/Constants.FACTOR,this.position[1]=(Game.instance().gameStage.stageHeight-this.starSprite.y)/Constants.FACTOR,this.angle=-this.starSprite.rotation*Math.PI/180},e}(p2.Body);__reflect(StarBody.prototype,"StarBody");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function i(i){e.call(n,i,t)}if(RES.hasRes(t)){var s=RES.getRes(t);s?i(s):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),[4,platform.login()];case 2:return t=e.sent(),console.log("ret %o",t),this.createGameScene(t.code),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return n.sent(),this.stage.removeChild(t),[3,5];case 4:return e=n.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,n){var i=new eui.Theme("resource/default.thm.json",t.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(t){Account.GetInstance().setCode(t),Game.instance().setStage(this.stage),Game.instance().gameScene.gotoMenu()},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,i){function s(t){e.call(i,t)}function o(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),n.call(i))}var a=this;"undefined"!=typeof generateEUI?egret.callLater(function(){e.call(i,generateEUI)},this):"undefined"!=typeof generateEUI2?RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(i,generateEUI2)},a)},this,RES.ResourceItem.TYPE_JSON):(RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,o,null),RES.getResByUrl(t,s,this,RES.ResourceItem.TYPE_TEXT))},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var Account=function(){function t(){this._userId=0,this._score=new Score,this._code="",this._openId="",this._existed=!1;var t=WxApi.getSystemInfoSync();this._userInfo={avatarUrl:"",city:"",country:"",doubleScoreTime:0,gender:0,model:"",nickname:"",province:"",resurrectionCard:0,skin:"",thirdid:"",topScore:0,system:t.system,systemLanguage:t.language,version:t.version}}return t.GetInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.setCode=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this._code=t,[2]})})},t.prototype.addScore=function(t){var e=this._score.addScore(t);return e},t.prototype.getScore=function(){return this._score.getScore()},t.prototype.resetScore=function(){this._score.reset()},t.prototype.addStar=function(t){var e=this._userInfo.star?this._userInfo.star:0;return e+=t,this._userInfo.star=e,this.updateInfo({star:e}),e},Object.defineProperty(t.prototype,"userInfo",{get:function(){return this._userInfo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"openId",{get:function(){return this._openId},enumerable:!0,configurable:!0}),t.prototype.getDoubleScoreTimes=function(){return 0},t.prototype.addItem=function(t,e){this._userInfo[t]=(this._userInfo[t]||0)+e},t.prototype.setInfo=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return this._existed?[3,2]:(this.updateUserInfo(t),[4,AccountApi.initUserInfo(this._userInfo)]);case 1:e=n.sent(),this.updateUserInfo(e.data),n.label=2;case 2:return[2]}})})},t.prototype.getInfo=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,i;return __generator(this,function(s){switch(s.label){case 0:return this._openId?[3,2]:[4,AccountApi.getWxOpenId(this._code,Constants.appSecret,Constants.appId,"authorization_code")];case 1:e=s.sent(),this._openId=e,s.label=2;case 2:if(console.log("获取的openid:"+this._openId),!this._openId)return[2];s.label=3;case 3:return s.trys.push([3,5,,6]),[4,AccountApi.getUserInfoByOpenId(this._openId)];case 4:return n=s.sent(),n&&(this._existed=!0),this.updateUserInfo(n),t&&t(this._userInfo),[3,6];case 5:return i=s.sent(),console.log("根据openid获取userdata失败%o",i),t&&t(null),[3,6];case 6:return[2]}})})},t.prototype.updateUserInfo=function(t){var e=this;Object.keys(t).forEach(function(n){var i=n;"nickName"==n&&(n="nickname"),e._userInfo[n]=t[i]}),this._openId&&(this._userInfo.thirdid=this._openId)},t.prototype.updateInfo=function(t){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(i){switch(i.label){case 0:for(e in t)this._userInfo[e]=t[e];return[4,AccountApi.updateUserInfo(this._userInfo)];case 1:return n=i.sent(),this.updateUserInfo(n),[2]}})})},t.prototype.updateReviveCard=function(t,e,n){return void 0===n&&(n=null),__awaiter(this,void 0,void 0,function(){var i,s,o;return __generator(this,function(a){switch(a.label){case 0:i="";for(s in t)i+="/"+s+"/"+t[s];return[4,AccountApi.updateReviveCard(i)];case 1:return o=a.sent(),e&&e.call(n,o),[2]}})})},t.prototype.getRank=function(t,e,n,i){return void 0===i&&(i=null),__awaiter(this,void 0,void 0,function(){var s,o;return __generator(this,function(a){switch(a.label){case 0:return s="/pageNum/"+t+"/pageSize/"+e,[4,AccountApi.getRank(s)];case 1:return o=a.sent(),n&&n.call(i,o),[2]}})})},t.RANK_TYPE={FRIEND:1,GROUP:2},t._instance=null,t}();__reflect(Account.prototype,"Account");var Ball=function(t){function e(n,i){var s=t.call(this,n)||this;s.BALL_RADIUS=Constants.BASKET_SIZEFACTOR,s._status=e.STATUS.FREE,s.id=i,s._startPosition={x:0,y:0,angle:0},s._startDisplayPos={x:0,y:0,angle:0},s._currentDragPosition={x:0,y:0,angle:0},s._velocity={x:0,y:0},s._display=utils.createBitmapByName("flowerball_png");var o=new p2.Circle({radius:s.BALL_RADIUS,material:new p2.Material(Constants.BALL_MATERIAL)});return s.addShape(o),s._ballShape=o,s.sleepSpeedLimit=.01,s.sleepTimeLimit=1,s._display.width=2*o.radius*Constants.FACTOR,s._display.height=2*o.radius*Constants.FACTOR,s._display.anchorOffsetX=s._display.width/2,s._display.anchorOffsetY=s._display.height/2,s.displays=[s._display],s}return __extends(e,t),e.prototype.display=function(){return this._display},e.prototype.getShape=function(){return this._ballShape},e.prototype.resetPosition=function(t,e){this._display.x=t,this._display.y=e,this.position[0]=t/Constants.FACTOR,this.position[1]=(Game.instance().gameStage.stageHeight-e)/Constants.FACTOR,this._startPosition.x=this.position[0],this._startPosition.y=this.position[1],this._startPosition.angle=this.shapes[0].angle,this._startDisplayPos.x=this._display.x,this._startDisplayPos.y=this._display.y,this._currentDragPosition.x=this.position[0],this._currentDragPosition.y=this.position[1],this._currentDragPosition.angle=this.shapes[0].angle},e.prototype.updateDisplayPosition=function(){var t=this.position[0]*Constants.FACTOR,n=Game.instance().gameStage.stageHeight-this.position[1]*Constants.FACTOR;if(this._status==e.STATUS.FLY)this._display.x=t,this._display.y=n,this._display.rotation=360-180*(this.angle+this.shapes[0].angle)/Math.PI;else if(this._status==e.STATUS.DRAG){var i=new egret.Point;i.x=t,i.y=n,this._trackPoints.push(i)}if(this._status==e.STATUS.FLY&&(this.sleepState==p2.Body.SLEEPING||this.sleepState==p2.Body.SLEEPY)){for(var s=this.world.broadphase.result,o=0,a=0;a<s.length;a++)s[a].id==Constants.BODY_ID.BALL&&o++,s[a].id==Constants.BODY_ID.BASKET_1+Constants.BODY_ID.NET&&o++,s[a].id==Constants.BODY_ID.BASKET_1+Constants.BODY_ID.TOPMASK&&o++;o>=3&&(console.log("sleepy and reset 了"),this.resetStatus())}},e.prototype.isCanShoot=function(){var t=Constants.FACTOR*Math.abs(this._currentDragPosition.x-this._startPosition.x),e=Constants.FACTOR*Math.abs(this._currentDragPosition.y-this._startPosition.y);return 100>=e&&100>=t?!0:!1},e.prototype.startDrag=function(){this._trackPoints=[],this.position[0]=this._startPosition.x,this.position[1]=this._startPosition.y,this.angle=this._startPosition.angle,this._display.x=this.position[0]*Constants.FACTOR,this._display.y=Game.instance().gameStage.stageHeight-this.position[1]*Constants.FACTOR,this._startDisplayPos.x=this._display.x,this._startDisplayPos.y=this._display.y},e.prototype.drag=function(t,n){this._status=e.STATUS.DRAG,this._trackPoints=[];var i=n.x-t.x,s=n.y-t.y;this._velocity.x=-i*Constants.PRESS_RATIO,this._velocity.y=s*Constants.PRESS_RATIO,this._display.x=this._startDisplayPos.x+i/3,this._display.y=this._startDisplayPos.y+s/3,this.position[0]=this._display.x/Constants.FACTOR,this.position[1]=(Game.instance().gameStage.stageHeight-this._display.y)/Constants.FACTOR,this._currentDragPosition.x=this.position[0],this._currentDragPosition.y=this.position[1],this.applyImpulse([this._velocity.x,this._velocity.y],[0,0])},e.prototype.shoot=function(){if(0==this._velocity.x&&0==this._velocity.y)return void this.resetStatus();SoundManager.instance().playSound(2),this._status=e.STATUS.FLY,this.position[0]=this._startPosition.x,this.position[1]=this._startPosition.y,this._display.x=this._startDisplayPos.x,this._display.y=this._startDisplayPos.y;var t=0;0!=this._velocity.x&&(t=this._velocity.x/Math.abs(this._velocity.x)),this.applyImpulse([this._velocity.x,this._velocity.y],[.1*t,.1]),this._velocity.x=0,this._velocity.y=0},e.prototype.getTrackPoints=function(){return this._trackPoints},e.prototype.getStatus=function(){return this._status},e.prototype.resetStatus=function(){this._status=e.STATUS.FREE,Game.instance().gameScene.mainGame.stop()},e.STATUS={FREE:0,DRAG:1,FLY:2},e}(p2.Body);__reflect(Ball.prototype,"Ball");var Basket=function(t){function e(e){var n=t.call(this)||this;return n._id=0,n._oldHeight=0,n._path=[[-86,-51.5],[-79,-51.5],[-77.5,-49],[-64.5,-11],[-50.5,13],[-40.5,24],[-31,31.5],[-19,37.5],[-8,40.5],[7,40.5],[18,37.5],[28,32.5],[41,22.5],[51.5,10],[63.5,-11],[77.5,-51],[87,-51.5],[87.5,-48],[70.5,-2],[56.5,22],[47.5,32],[32,43.5],[17,49.5],[-14,50.5],[-27,46.5],[-41,38.5],[-53,27.5],[-60.5,18],[-74.5,-9],[-88.5,-48],[-88.5,-51],[-87,-51.5]],n._bodies=[],n._id=e,n._floorConfig=null,n}return __extends(e,t),e.prototype.createView=function(t){this._floorConfig=t,this.x=t.x,this.y=Game.instance().gameStage.stageHeight/2-t.y+100;var e=!1,n=utils.createBitmapByName("basket_front_png");n.x=0,n.y=0,n.scaleX=Constants.BASKET_SIZEFACTOR,n.scaleY=Constants.BASKET_SIZEFACTOR,this.addChild(n),this._display=n;var i=utils.createBall(8);i.x=15,i.y=0,i.name="left",i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.visible=e,this.addChild(i),this._leftShape=i;var s=utils.createBall(8);s.x=Constants.BASKET_WIDTH-15,s.y=0,s.name="right",s.anchorOffsetX=s.width/2,s.anchorOffsetY=s.height/2,s.visible=e,this.addChild(s),this._rightShape=s;var o=utils.createPolygon(this._path);o.x=o.width/2+30,o.y=o.height/2+25,o.anchorOffsetX=0,o.anchorOffsetY=0,o.name="net",o.visible=e,this.addChild(o),this._netShape=o;var a=utils.createBox(this.width-60,20);return a.x=this.width/2,a.y=30,a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,this.addChild(a),a.visible=e,this._topShape=a,this.anchorOffsetX=this.width/2,this.anchorOffsetY=this.height/2,this.rotation=t.angle,!0},e.prototype.createBody=function(){var t=this.localToGlobal(this._leftShape.x,this._leftShape.y),e=new p2.Circle({radius:this._leftShape.width/2/Constants.FACTOR,material:new p2.Material(Constants.BASKET_MATERIAL)}),n=new p2.Body({mass:0,position:[t.x/Constants.FACTOR,(egret.MainContext.instance.stage.stageHeight-t.y)/Constants.FACTOR]});n.displays=[this._leftShape],n.addShape(e),n.id=this._id+Constants.BODY_ID.LEFT_POINT,this._bodies.push(n),this._leftBody=n,t=this.localToGlobal(this._rightShape.x,this._rightShape.y);var i=new p2.Circle({radius:this._rightShape.width/2/Constants.FACTOR,material:new p2.Material(Constants.BASKET_MATERIAL)}),s=new p2.Body({mass:0,position:[t.x/Constants.FACTOR,(egret.MainContext.instance.stage.stageHeight-t.y)/Constants.FACTOR]});s.displays=[this._rightShape],s.addShape(i),s.id=this._id+Constants.BODY_ID.RIGHT_POINT,this._bodies.push(s),this._rightBody=s,t=this.localToGlobal(this._netShape.x,this._netShape.y);for(var o=0;o<this._path.length;o++)this._path[o][0]=this._path[o][0]/Constants.FACTOR*Constants.BASKET_SIZEFACTOR,this._path[o][1]=-this._path[o][1]/Constants.FACTOR*Constants.BASKET_SIZEFACTOR;var a=new p2.Body({mass:0,position:[t.x/Constants.FACTOR,(egret.MainContext.instance.stage.stageHeight-t.y)/Constants.FACTOR],material:new p2.Material(Constants.NET_MATERIAL)});a.fromPolygon(this._path),a.angle=-this.rotation*Math.PI/180,a.displays=[this._netShape],a.id=this._id+Constants.BODY_ID.NET,this._bodies.push(a),this._netBody=a,t=this.localToGlobal(this._topShape.x,this._topShape.y);var r=new p2.Box({width:this._topShape.width/Constants.FACTOR,height:this._topShape.height/Constants.FACTOR}),h=new p2.Body({mass:0,collisionResponse:!1,position:[t.x/Constants.FACTOR,(egret.MainContext.instance.stage.stageHeight-t.y)/Constants.FACTOR]});h.addShape(r),h.displays=[this._topShape],h.angle=-this.rotation*Math.PI/180,h.id=this._id+Constants.BODY_ID.TOPMASK,this._bodies.push(h),this._topBody=h},e.prototype.setBasketBack=function(t){this._basketBack=t},e.prototype.getBodies=function(){return this._bodies},e.prototype.repositionByDisplay=function(){var t=this.localToGlobal(this._leftShape.x,this._leftShape.y);this._leftBody.position[0]=t.x/Constants.FACTOR,this._leftBody.position[1]=(egret.MainContext.instance.stage.stageHeight-t.y)/Constants.FACTOR,t=this.localToGlobal(this._rightShape.x,this._rightShape.y),this._rightBody.position[0]=t.x/Constants.FACTOR,this._rightBody.position[1]=(egret.MainContext.instance.stage.stageHeight-t.y)/Constants.FACTOR,t=this.localToGlobal(this._netShape.x,this._netShape.y),this._netBody.position[0]=t.x/Constants.FACTOR,this._netBody.position[1]=(egret.MainContext.instance.stage.stageHeight-t.y)/Constants.FACTOR,this._netBody.angle=-this.rotation*Math.PI/180,t=this.localToGlobal(this._topShape.x,this._topShape.y),this._topBody.position[0]=t.x/Constants.FACTOR,this._topBody.position[1]=(egret.MainContext.instance.stage.stageHeight-t.y)/Constants.FACTOR,this._topBody.angle=-this.rotation*Math.PI/180},e.prototype.startMove=function(){if(!(this._floorConfig.moveDirection<=0)){var t=egret.Tween.get(this,{loop:!0,onChange:this.onBasketMove,onChangeObj:this});1==this._floorConfig.moveDirection?t.to({x:this.x+100},1e3).to({x:this.x},1e3):2==this._floorConfig.moveDirection&&t.to({y:this.y+100},1e3).to({y:this.y},1e3)}},e.prototype.stopMove=function(){egret.Tween.removeTweens(this)},e.prototype.onBasketMove=function(t){this.repositionByDisplay(),this._basketBack.resetPosition()},e.prototype.getNetBody=function(){return this._netBody},e.prototype.getTopMaskBody=function(){return this._topBody},e.prototype.reset=function(t){this._floorConfig.moveDirection>0&&this.stopMove(),this.x=t.x,this.y=t.y,this.rotation=t.angle,this.repositionByDisplay(),this._floorConfig=t},e.prototype.showEffect=function(t,e){this.rotation=0,this.stopMove(),this.repositionByDisplay();var n="";t.hole&&t.rebound?n="空心+反弹":t.hole?n="空心球":t.rebound&&(n="反弹球"),n+=" +"+e+"分";var i=new egret.TextField;this.globalToLocal(this.x,this.y-(this.height/2+20));i.x=Constants.BASKET_WIDTH/2,i.y=Constants.BASKET_HEIGHT/2-80,i.text=n,i.anchorOffsetX=this.anchorOffsetX,i.anchorOffsetY=this.anchorOffsetY,this.addChild(i);var s=this,o=egret.Tween.get(i);o.to({y:i.y-50},1e3).call(function(){s.removeChild(i)})},e.prototype.changeBodyId=function(t){this._id=t,this._leftBody.id=t+Constants.BODY_ID.LEFT_POINT,this._rightBody.id=t+Constants.BODY_ID.RIGHT_POINT,this._netBody.id=t+Constants.BODY_ID.NET,this._topBody.id=t+Constants.BODY_ID.TOPMASK},e.prototype.drag=function(t,e){this._oldHeight=this._display.height;var n=utils.distance(t.x,t.y,e.x,e.y),i=Constants.BASKET_SIZEFACTOR+n/this._display.height/2;this._display.scaleY=i},e.prototype.shoot=function(){this._display.scaleY=Constants.BASKET_SIZEFACTOR},e}(egret.Sprite);__reflect(Basket.prototype,"Basket");var BasketBack=function(t){function e(e){var n=t.call(this)||this;return n._basket=e,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n}return __extends(e,t),e.prototype.onAddToStage=function(t){var e=utils.createBitmapByName("basket_back_png");e.x=0,e.y=0,e.scaleX=Constants.BASKET_SIZEFACTOR,e.scaleY=Constants.BASKET_SIZEFACTOR,this.addChild(e),this.anchorOffsetX=Constants.BASKET_WIDTH/2,this.anchorOffsetY=Constants.BASKET_HEIGHT/2+15-6},e.prototype.resetPosition=function(){this.x=this._basket.x,this.y=this._basket.y,this.rotation=this._basket.rotation},e.prototype.drag=function(t,e){var n=utils.angle(t.x,t.y,e.x,e.y);this.rotation=n,this._basket.rotation=n,this._basket.repositionByDisplay()},e}(egret.Sprite);__reflect(BasketBack.prototype,"BasketBack");var Constants=function(){function t(){}return t.stageWidth=750,t.stageHeight=1330,t.FACTOR=50,t.WORLD_GRAVITY=-100,t.BALL_MASS=6,t.PRESS_RATIO=3.5,t.BASKET_WIDTH=205,t.BASKET_HEIGHT=184,t.BASKET_SIZEFACTOR=1,t.STAR_ID=50,t.COLLSION_YES=Math.pow(2,0),t.COLLSION_NO=Math.pow(2,1),t.BALL_MATERIAL=1e3,t.NET_MATERIAL=1001,t.BASKET_MATERIAL=1002,t.BODY_ID={BALL:1,BASKET_1:100,BASKET_2:200,LEFT_BORDER:10,RIGHT_BORDER:11,LEFT_POINT:2,RIGHT_POINT:3,NET:4,TOPMASK:5},t.BaseUrl="https://wxmini.dftoutiao.com/shoot",t.BASE_IP="https://wxmini.dftoutiao.com/",t.appId="wxd5f99c1670c42135",t.appSecret="66dc7a2b83336b56e0fddadf5b5d7c2f",t}();__reflect(Constants.prototype,"Constants");var FloorConfig=function(){function t(t,e,n,i,s,o){this.isStar=!1,this.x=t,this.y=e,this.angle=n,i>0?this.moveDirection=i:this.moveDirection=0,s?this.moveSpeed=s:this.moveSpeed=0,this.isStar=o}return t}();__reflect(FloorConfig.prototype,"FloorConfig");var Floor=function(){function t(){this._currentFloor=0}return t.prototype.createConfig=function(){var t=Game.instance().gameStage.stageWidth,e=0;e=0==this._currentFloor?-150:1==this._currentFloor?150:300;var n=this._currentFloor%2==0?220:t-220,i=0,s=0,o=0,a=45,r=this._currentFloor>5?!0:!1;if(this._currentFloor<=6&&(s=this._currentFloor%2==1?360-a:a),this._currentFloor>6&&(a=45*Math.random(),s=this._currentFloor%2==1?360-a:a),this._currentFloor>16){var h=Math.floor(5*Math.random()),c=h%5==0?1:0;1==c&&(o=Math.random()>.5?1:2,i=5+5*Math.random())}this._currentFloor++;var l=new FloorConfig(n,e,s,o,i,r);return l},t.prototype.nextFloor=function(){return this._currentConfig=this.createConfig(),this._currentConfig},Object.defineProperty(t.prototype,"currentConfig",{get:function(){return this._currentConfig},enumerable:!0,configurable:!0}),t.prototype.restart=function(){this._currentFloor=0},t}();__reflect(Floor.prototype,"Floor");var Game=function(){function t(){}return t.instance=function(){return null==this._instance&&(this._instance=new t),this._instance},t.prototype.setStage=function(t){this._gameStage=t,this._gameScene=new GameScene,this._gameView=new GameView,this._bottom=new egret.DisplayObjectContainer,this._middle=new egret.DisplayObjectContainer,this._top=new egret.DisplayObjectContainer,this._gameStage.addChild(this._bottom),this._gameStage.addChild(this._middle),this._gameStage.addChild(this._top)},t.prototype.addBottom=function(t,e){void 0===e&&(e=!0),e&&this._bottom.removeChildren(),this._bottom.addChild(t)},t.prototype.addMiddle=function(t,e){void 0===e&&(e=!0),e&&this._middle.removeChildren(),this._middle.addChild(t)},t.prototype.addTop=function(t,e){void 0===e&&(e=!0),e&&this._top.removeChildren(),this._top.addChild(t)},Object.defineProperty(t.prototype,"gameStage",{get:function(){return this._gameStage},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bottom",{get:function(){return this._bottom},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"middle",{get:function(){return this._middle},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"top",{get:function(){return this._top},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gameScene",{get:function(){return this._gameScene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gameView",{get:function(){return this._gameView},enumerable:!0,configurable:!0}),t._instance=null,t}();__reflect(Game.prototype,"Game");var GameScene=function(){function t(){}return t.prototype.gotoMenu=function(){Game.instance().gameView.hide(),this._menuScene?this._menuScene.setData():this._menuScene=new GuideScene,Game.instance().addBottom(this._menuScene)},t.prototype.gotoGame=function(){if(Game.instance().gameView.hide(),this._mainGame)this._mainGame.restartGame();else{var t=new MainGame;this._mainGame=t}Game.instance().addBottom(this._mainGame)},Object.defineProperty(t.prototype,"menuScene",{get:function(){return this._menuScene},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mainGame",{get:function(){return this._mainGame},enumerable:!0,configurable:!0}),t}();__reflect(GameScene.prototype,"GameScene");var GameView=function(){function t(){this.init()}return t.prototype.init=function(){var e=this;this._displays=[];var n=utils.createBox(Game.instance().gameStage.stageWidth,Game.instance().gameStage.stageHeight,0);n.x=0,n.y=0,n.alpha=.5;var i=new egret.Sprite;i.addChild(n),i.touchEnabled=!0,this._blackBg=i,this._blackBg.touchEnabled=!0,this._blackBg.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){e.hide()},this);var s;s=new DoubleScorePage,s.name=t.PAGE.DOUBLESCORE,this._displays.push(s),s=new RevivePromotion,s.name=t.PAGE.REVIVE,this._displays.push(s),s=new RankPage,s.name=t.PAGE.RANK,this._displays.push(s),s=new SkinPage,s.name=t.PAGE.SKIN,this._displays.push(s),s=new TipsPage,s.name=t.PAGE.TIPS,this._displays.push(s),s=new GameOverPannel,s.name=t.PAGE.GAMEOVER,this._displays.push(s),s=new GameOverResult,s.name=t.PAGE.RESULT,this._displays.push(s)},t.prototype.showPage=function(e){this._blackBg.touchEnabled=!0;for(var n=0;n<this._displays.length;n++){var i=this._displays[n];if(i.name==e){Game.instance().addMiddle(this._blackBg),Game.instance().addMiddle(i,!1),i.anchorOffsetX=i.width/2,i.anchorOffsetY=i.height/2,i.x=Game.instance().gameStage.stageWidth/2,i.y=Game.instance().gameStage.stageHeight/2,(e==t.PAGE.GAMEOVER||e==t.PAGE.RESULT)&&(this._blackBg.touchEnabled=!1,i.setData());break}}},t.prototype.hide=function(){Game.instance().middle.removeChildren()},t.PAGE={DOUBLESCORE:"double",REVIVE:"revive",RANK:"rank",SKIN:"skin",GAMEOVER:"gameover",TIPS:"tips",RESULT:"result"},t}();__reflect(GameView.prototype,"GameView");var Utils=p2.Utils,MainGame=function(t){function e(){var e=t.call(this)||this;return e._timestamp=0,e._background=null,e._ball=null,e._world=null,e._stageWidth=0,e._stageHeight=0,e._worldEvent=null,e.points={start:new egret.Point(0,0),end:new egret.Point(0,0)},e.dragDistanceX=100,e.dragDistanceY=100,e.isStartDrag=!1,e.once(egret.Event.ADDED_TO_STAGE,e.init,e),e}return __extends(e,t),e.prototype.init=function(){var t=new StageBackground;t.x=0,t.y=0,this.addChild(t),this._background=t,this._offsetY=0,this._stageWidth=egret.MainContext.instance.stage.stageWidth,this._stageHeight=egret.MainContext.instance.stage.stageHeight,this._mapDisableBody={},this._world=new p2.World,this._world.gravity=[0,Constants.WORLD_GRAVITY],this._world.defaultContactMaterial.restitution=.5;var e=new p2.Material(Constants.BALL_MATERIAL),n=new p2.Material(Constants.NET_MATERIAL),i=new p2.Material(Constants.BASKET_MATERIAL),s=new p2.ContactMaterial(e,n,{restitution:.01,friction:0});this._world.addContactMaterial(s);var o=new p2.ContactMaterial(e,i,{restitution:.6,friction:.3});if(this._world.addContactMaterial(o),this._trackBoard=new egret.Shape,this.addChild(this._trackBoard),this._debugBoard=new egret.Shape,this._floor=new Floor,this.createScorePanel(),this.createStarPanel(),this.createPauseButton(),this.createBasket(Constants.BODY_ID.BASKET_1),this.createBasket(Constants.BODY_ID.BASKET_2),!this._ball){var a=new egret.Point(this._basket1.x,this._basket1.y);this._ball=new Ball({mass:Constants.BALL_MASS,angularVelocity:1},Constants.BODY_ID.BALL),this._ball.resetPosition(a.x,a.y)}this._world.addBody(this._ball),this.addChild(this._ball.display()),this._world.sleepMode=p2.World.BODY_SLEEPING,this.setChildIndex(this._basketBack1,100),this.setChildIndex(this._basketBack2,99),this.setChildIndex(this._ball.display(),98),this.setChildIndex(this._basket1,97),this.setChildIndex(this._basket2,96),this.createBorder(),this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.TouchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.TouchBegin,this),this.touchEnabled=!0,this._worldEvent=new WorldEvent(this._world),this._worldEvent.listenEvent(),this._worldEvent.addEventListener("GAME_SCORE",this.gameScore,this),this._worldEvent.addEventListener("GAME_OVER",this.gameOver,this),this._worldEvent.addEventListener("GAME_STAR",this.gameStarContact,this),this.monitorBody(),this.createStar()},e.prototype.createScorePanel=function(){this._scorePanel=new ScorePanel,this.addChild(this._scorePanel),this._scorePanel.anchorOffsetX=this._scorePanel.width/2,this._scorePanel.anchorOffsetY=0,this._scorePanel.x=Game.instance().gameStage.stageWidth/2,this._scorePanel.y=110},e.prototype.createStarPanel=function(){this._starNumPanel=new StarPanel,this.addChild(this._starNumPanel),this._starNumPanel.x=(Game.instance().gameStage.stageWidth-this._starNumPanel.width)/2+120,this._starNumPanel.y=10;var t=Account.GetInstance().addStar(0);this._starNumPanel.setStarNum(t)},e.prototype.createPauseButton=function(){this._btnPause=utils.createBitmapByName("main_png"),this._btnPause.x=20,this._btnPause.y=12,this._btnPause.touchEnabled=!0,this.addChild(this._btnPause),this._btnPause.addEventListener(egret.TouchEvent.TOUCH_TAP,this.goHome,this),this.setChildIndex(this._btnPause,1e5)},e.prototype.createBasket=function(t){var e=this._floor.nextFloor(),n=new Basket(t);n.createView(e),this.addChild(n),n.createBody(),n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2;for(var i=n.getBodies(),s=0;s<i.length;s++)this._world.addBody(i[s]);var o=new BasketBack(n);this.addChild(o),o.resetPosition(),n.setBasketBack(o),t==Constants.BODY_ID.BASKET_1?(this._basket1=n,this._basketBack1=o):t==Constants.BODY_ID.BASKET_2&&(this._basket2=n,this._basketBack2=o)},e.prototype.createStar=function(){if(this.removeStar(),this._floor.currentConfig.isStar){var t=new StarBody,e=t.displays[0],n=this._basket2.rotation*Math.PI/180,i=250-100*Math.random(),s=this._basket2.x+i*Math.sin(n),o=this._basket2.y-i*Math.cos(n),a=this.localToGlobal(s,o);t.updatePosition(a.x,a.y),e.alpha=0,this.addChild(e),egret.Tween.get(e).to({alpha:1},400),this._world.addBody(t),this.starBodies.push(t)}},e.prototype.removeStar=function(){var t=this;if(!this.starBodies||0==this.starBodies.length)return void(this.starBodies=[]);var e=this.starBodies.pop();this.starBodies=[];var n=e.displays[0];egret.Tween.get(n).to({alpha:0},200).call(function(){t.removeChild(n),t._world.removeBody(e)})},e.prototype.TouchBegin=function(t){var e={};if(t.type==egret.TouchEvent.TOUCH_BEGIN)this.isStartDrag=!0,this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.TouchBegin,this),this.points.start.x=t.stageX,this.points.start.y=t.stageY,e.data={start:this.points.start,end:this.points.end},this.startDrag(e);else if(t.type==egret.TouchEvent.TOUCH_MOVE){if(!this.isStartDrag)return void this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.TouchBegin,this);this.points.end.x=t.stageX,this.points.end.y=t.stageY,this.calEnd(),e.data={start:this.points.start,end:this.points.end},this.drag(e)}else if(t.type==egret.TouchEvent.TOUCH_END){if(!this.isStartDrag)return void this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.TouchBegin,this);if(this.points.end.x=t.stageX,this.points.end.y=t.stageY,!this.calEnd())return;e.data={start:this.points.start,end:this.points.end},this.shoot(e)}},e.prototype.calEnd=function(){var t=this.points.end.x-this.points.start.x,e=this.points.end.y-this.points.start.y;return Math.abs(t)>this.dragDistanceX?this.points.end.x=this.points.start.x+this.dragDistanceX*t/Math.abs(t):Math.abs(t)<2&&(this.points.end.x=this.points.start.x),Math.abs(e)>this.dragDistanceY?this.points.end.y=this.points.start.y+this.dragDistanceY*e/Math.abs(e):Math.abs(e)<2&&(this.points.end.y=this.points.start.y),Math.abs(t)<2&&Math.abs(e)<2?!1:!0
},e.prototype.continueGame=function(){this._basketBack1.resetPosition(),this._basketBack2.resetPosition(),this._ball.resetStatus();var t=new egret.Point(this._basket1.x,this._basket1.y);this._ball.resetPosition(t.x,t.y),this._trackBoard.graphics.clear()},e.prototype.restartGame=function(){this.stop(),this.stopAllBody(),Account.GetInstance().resetScore(),this._trackBoard.graphics.clear(),this._debugBoard.graphics.clear();var t=Account.GetInstance().addStar(0);this._starNumPanel.setStarNum(t),this._scorePanel.setDoubleTimes(Account.GetInstance().getDoubleScoreTimes()),this._scorePanel.setScore(0),this._floor.restart();var e=this._floor.nextFloor();e.y=Game.instance().gameStage.stageHeight/2-e.y+100,this._basket1.reset(e),this._basketBack1.resetPosition();var n=this._floor.nextFloor();n.y=Game.instance().gameStage.stageHeight/2-n.y+100,this._basket2.reset(n),this._basketBack2.resetPosition(),this._ball.resetStatus();var i=new egret.Point(this._basket1.x,this._basket1.y);this._ball.resetPosition(i.x,i.y),this.createStar(),this.removeChild(this._background),this._background=new StageBackground,this.addChildAt(this._background,0)},e.prototype.createBorder=function(){var t=new p2.Box({width:1e3/Constants.FACTOR,height:2*this._stageHeight/Constants.FACTOR,material:new p2.Material(3)}),e=new p2.Body({mass:0,position:[-500/Constants.FACTOR,this._stageHeight/2/Constants.FACTOR]});e.addShape(t),e.displays=[],e.id=Constants.BODY_ID.LEFT_BORDER,this._world.addBody(e);var n=new p2.Box({width:1e3/Constants.FACTOR,height:2*this._stageHeight/Constants.FACTOR,material:new p2.Material(4)}),i=new p2.Body({mass:0,position:[(this._stageWidth+500)/Constants.FACTOR,this._stageHeight/2/Constants.FACTOR]});i.addShape(n),i.displays=[],i.id=Constants.BODY_ID.RIGHT_BORDER,this._world.addBody(i),this._world.addContactMaterial(new p2.ContactMaterial(t.material,this._ball.getShape().material,{restitution:0,stiffness:999999999,relaxation:.2,friction:.3})),this._world.addContactMaterial(new p2.ContactMaterial(n.material,this._ball.getShape().material,{restitution:0,stiffness:999999999,relaxation:.2,friction:.3}))},e.prototype.run=function(){egret.startTick(this.loop,this)},e.prototype.stop=function(){egret.stopTick(this.loop,this),this._timestamp=0},e.prototype.loop=function(t){var e=40;this._timestamp>0&&(e=t-this._timestamp),this._timestamp=t,10>e||e>1e3||this.step(e)},e.prototype.step=function(t){this._world.step(t/1e3);for(var e=this._world.bodies.length,n=0;e>n;n++){var i=this._world.bodies[n],s=i.displays[0];if(i instanceof Ball){i.updateDisplayPosition();var o=i.position[0]*Constants.FACTOR,a=egret.MainContext.instance.stage.stageHeight-i.position[1]*Constants.FACTOR;this._debugBoard.graphics.beginFill(0),this._debugBoard.graphics.drawCircle(o,a,5),this._debugBoard.graphics.endFill(),this._worldEvent.judgeLose(i.position[0],i.position[1])}else if(s&&s.parent instanceof Basket){var o=i.position[0]*Constants.FACTOR,a=this._stageHeight-i.position[1]*Constants.FACTOR,r=s.parent.globalToLocal(o,a);s.x=r.x,s.y=r.y}else i instanceof StarBody?this._worldEvent.judgeLose(i.position[0],i.position[1]):s&&(s.x=i.position[0]*Constants.FACTOR,s.y=this._stageHeight-i.position[1]*Constants.FACTOR,s.rotation=360-180*(i.angle+i.shapes[0].angle)/Math.PI,i.sleepState==p2.Body.SLEEPING?s.alpha=1:s.alpha=1)}},e.prototype.startDrag=function(t){this._ball.getStatus()!=Ball.STATUS.FLY&&(this._trackBoard.graphics.clear(),this.stopAllBody(),this._ball.startDrag())},e.prototype.drag=function(t){if(this._ball.getStatus()!=Ball.STATUS.FLY){this.stop(),this._worldEvent.setStatus(0),this.stopAllBody(),this._ball.drag(t.data.start,t.data.end),this._basket1.drag(t.data.start,t.data.end),this._basketBack1.drag(t.data.start,t.data.end),this.simulate_move(),this._trackBoard.graphics.clear();for(var e=this._ball.getTrackPoints(),n=0;n<e.length;n++)this._trackBoard.graphics.beginFill(16777215),this._trackBoard.graphics.drawCircle(e[n].x,e[n].y,15-n),this._trackBoard.graphics.endFill()}},e.prototype.shoot=function(t){this._ball.getStatus()!=Ball.STATUS.FLY&&this._ball.isCanShoot()&&(this._debugBoard.graphics.clear(),this._trackBoard.graphics.clear(),this.stopAllBody(),this._worldEvent.setStatus(1),this._basketBack1.drag(t.data.start,t.data.end),this.run(),this._ball.velocity=[0,0],this._ball.shoot(),this._basket1.shoot())},e.prototype.simulate_move=function(){this.setAllCollisionStatus(!1);for(var t=0;10>t;t++)this._world.step(.04),this._ball.updateDisplayPosition();this.setAllCollisionStatus()},e.prototype.stopAllBody=function(){for(var t=this._world.bodies.length,e=0;t>e;e++){var n=this._world.bodies[e];n&&n.sleep()}},e.prototype.monitorBody=function(){var t=[Constants.BODY_ID.LEFT_BORDER,Constants.BODY_ID.RIGHT_BORDER,Constants.BODY_ID.BASKET_2+Constants.BODY_ID.LEFT_POINT,Constants.BODY_ID.BASKET_2+Constants.BODY_ID.RIGHT_POINT,Constants.BODY_ID.BASKET_2+Constants.BODY_ID.NET,Constants.BODY_ID.BASKET_2+Constants.BODY_ID.TOPMASK,Constants.STAR_ID];this._worldEvent.setMonitorBody(t),this._worldEvent.setBallAndNetId(Constants.BODY_ID.BALL,Constants.BODY_ID.BASKET_2+Constants.BODY_ID.NET,Constants.BODY_ID.BASKET_2+Constants.BODY_ID.TOPMASK),this._worldEvent.setStarId(Constants.STAR_ID)},e.prototype.gameScore=function(t){this.stop(),this._trackBoard.graphics.clear(),this._debugBoard.graphics.clear();var e=t.data,n=ScoreUtil.calScore(e);n.hole?SoundManager.instance().playSound(1):SoundManager.instance().playSound(0);var i=Account.GetInstance().addScore(n);this._basket2.showEffect(n,i),this._scorePanel.setScore(Account.GetInstance().getScore()),this._scorePanel.setDoubleTimes(Account.GetInstance().getDoubleScoreTimes()),this.handleBasket()},e.prototype.handleBasket=function(){var t=this,e=this._floor.nextFloor(),n=this._basket2.y-e.y,i=Game.instance().gameStage.stageHeight/2-this._basket2.y+e.y/2+100;e.y=n,this._basket1.reset(e),this._basket1.changeBodyId(Constants.BODY_ID.BASKET_2),this._basket2.changeBodyId(Constants.BODY_ID.BASKET_1),this._basketBack1.resetPosition(),this._basketBack2.resetPosition();var s=this._basket2;this._basket2=this._basket1,this._basket1=s;var o=this._basketBack2;this._basketBack2=this._basketBack1,this._basketBack1=o,this._background.scroll(i);var a=egret.Tween.get(this._basket1,{onChange:this.onBasketPosChange1,onChangeObj:this}),r=egret.Tween.get(this._basket2,{onChange:this.onBasketPosChange2,onChangeObj:this});a.to({y:this._basket1.y+i},500).call(function(){t._basket1.repositionByDisplay(),t._ball.resetPosition(t._basket1.x,t._basket1.y),t._ball.resetStatus()}),r.to({y:this._basket2.y+i},500).call(function(){t._basket2.repositionByDisplay(),t._basket2.startMove();var e=egret.setTimeout(function(){egret.clearTimeout(e),t.createStar()},t,200)})},e.prototype.onBasketPosChange1=function(){this._ball.resetPosition(this._basket1.x,this._basket1.y),this._basketBack1.resetPosition()},e.prototype.onBasketPosChange2=function(){this._basketBack2.resetPosition()},e.prototype.gameOver=function(t){return this._trackBoard.graphics.clear(),this._debugBoard.graphics.clear(),this.stop(),Account.GetInstance().getScore()<=0?void this.continueGame():void Game.instance().gameView.showPage(GameView.PAGE.GAMEOVER)},e.prototype.gameStarContact=function(t){var e=this,n=t.data;if(n){var i=n.displays[0],s=egret.Tween.get(i);s.to({x:this._starNumPanel.x+i.width/2,y:this._starNumPanel.y+i.height/2},500).call(function(){e.removeStar()});var o=Account.GetInstance().addStar(1);this._starNumPanel.setStarNum(o)}},e.prototype.goHome=function(t){this.stop(),this.stopAllBody(),this.removeStar(),Game.instance().gameScene.gotoMenu()},e.prototype.setAllCollisionStatus=function(t){void 0===t&&(t=!0);for(var e=this._world.bodies.length,n=0;e>n;n++)t?this._world.enableBodyCollision(this._ball,this._world.bodies[n]):this._world.disableBodyCollision(this._ball,this._world.bodies[n])},e}(egret.DisplayObjectContainer);__reflect(MainGame.prototype,"MainGame");var Score=function(){function t(){this._score=0,this._holeScoreTimes=0,this._holeAndReboundTimes=0,this._doubleScoreTimes=0}return t.prototype.addScore=function(t){var e=1;if(t.hole&&t.rebound){switch(this._holeAndReboundTimes){case 0:e=4;break;case 1:e=6;break;case 2:e=10;break;case 3:e=18;break;default:this._holeAndReboundTimes>0&&(e=18)}e=Math.min(e,18),this._holeAndReboundTimes+=1,this._holeScoreTimes+=1}else t.hole?(e=Math.pow(2,this._holeScoreTimes+1),e=Math.min(e,16),this._holeAndReboundTimes=0,this._holeScoreTimes+=1):t.rebound?(e=2,this._holeAndReboundTimes=0,this._holeScoreTimes=0):(e=1,this._holeAndReboundTimes=0,this._holeScoreTimes=0);return this._doubleScoreTimes>=1&&(this.consumeDoubleTimes(),e=2*e),this._score+=e,e},t.prototype.consumeDoubleTimes=function(){this._doubleScoreTimes-=1},t.prototype.getScore=function(){return this._score},t.prototype.reset=function(){this._score=0},t}();__reflect(Score.prototype,"Score");var ScoreUtil=function(){function t(){}return t.calScore=function(t){if(t.length<5)return null;var e=!1,n=!1;return(1==t[0]||1==t[1])&&(e=!0),0==t[2]&&0==t[3]&&(n=!0),{hole:n,rebound:e}},t}();__reflect(ScoreUtil.prototype,"ScoreUtil");var SoundManager=function(){function t(){this.wx=window.wx,this.isStopAll=!1}return t.instance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.playMusic=function(t){this._music&&this._music.destroy(),this._music=this.wx.createInnerAudioContext(),this._music.src="",this._music.play(),this._music.loop=!0,this._music.obeyMuteSwitch=!1},t.prototype.playSound=function(t){if(void 0===t&&(t=0),!this.isStopAll){var e="";0==t?e="goal.mp3":1==t?e="hollow.mp3":2==t&&(e="collision.mp3");var n=this.wx.createInnerAudioContext();n.loop=!1,n.src="resource/assets/sounds/"+e,n.play(),n.onEnded(function(){n.destroy()})}},t.prototype.mute=function(){console.log("play music"),this._music&&this._music.play()},t.prototype.stopAll=function(){this._music&&this._music.pause(),this.isStopAll=!this.isStopAll},t._instance=null,t}();__reflect(SoundManager.prototype,"SoundManager");var StageBackground=function(t){function e(){var e=t.call(this)||this;return e.backgrounds=[],e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=wx.getSystemInfoSync(),e=Game.instance().gameStage.stageWidth,n=Game.instance().gameStage.stageHeight;n>t.windowHeight&&(n=t.windowHeight*e/t.windowWidth);var i=utils.createBitmapByName("bj_1_png");i.x=0,i.y=0,i.width=e,i.height=n,i.name="first",this.addChild(i),this.backgrounds.push(i);for(var s=0;3>s;s++)i=utils.createBitmapByName("bj_2_png"),i.x=0,i.y=-(s+1)*n,i.name="bg"+s.toString(),i.height=n,this.addChild(i),this.backgrounds.push(i)},e.prototype.scroll=function(t){var e=this,n=this,i=this.backgrounds[0];this._currentBg=i;var s=egret.Tween.get(i,{onChange:this.onBackgroundScroll,onChangeObj:this});s.to({y:i.y+t},500).call(function(){i.y>Game.instance().gameStage.stageHeight&&(i.name.indexOf("bg")>=0?(i.y=-3*egret.MainContext.instance.stage.stageHeight+i.y,n.backgrounds.push(i),n.backgrounds.shift(),n._currentBg=e.backgrounds[0]):n.backgrounds.shift())})},e.prototype.onBackgroundScroll=function(t){if(this.backgrounds.length>1)for(var e=this._currentBg,n=1;n<this.backgrounds.length;n++){var i=this.backgrounds[n];e&&i&&(i.y=-n*egret.MainContext.instance.stage.stageHeight+e.y)}},e}(egret.Sprite);__reflect(StageBackground.prototype,"StageBackground");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=egret.MainContext.instance.stage.stageHeight/2-50,this.textField.width=egret.MainContext.instance.stage.stageWidth,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var WorldEvent=function(t){function e(e){var n=t.call(this)||this;return n.contact=function(t){if(n._status&&n._waitEvent){var e=t.bodyA,i=t.bodyB;if(e&&i){var s=e.id,o=i.id;if(s==n._ballId||o==n._ballId){var a=i;if(o==n._ballId){var r=s;s=o,o=r,a=e}var h=n._bodies.indexOf(o);0>h||(o==n._scoreId?1==n._contactMatrix[n._passIdIndex]&&(n._waitEvent=!1,n._scoreEvent.data=n._contactMatrix,n.dispatchEvent(n._scoreEvent)):(o==n._starId&&(n._starEvent.data=a,n.dispatchEvent(n._starEvent)),n._contactMatrix[h]=1))}}}},n._world=e,n._bodies=[],n._ballId=-1,n._scoreId=-1,n._starId=-1,n._passIdIndex=-1,n._scoreEvent=new egret.Event("GAME_SCORE"),n._gameOverEvent=new egret.Event("GAME_OVER"),n._starEvent=new egret.Event("GAME_STAR"),n._status=0,n._waitEvent=!1,n.listenEvent(),n}return __extends(e,t),e.prototype.judgeLose=function(t,e){var n=new egret.Point(t,e),i=utils.p2PointToStage(n);(i.x<0||i.x>egret.MainContext.instance.stage.stageWidth||i.y>egret.MainContext.instance.stage.stageHeight)&&this.dispatchEvent(this._gameOverEvent)},e.prototype.setMonitorBody=function(t){this._bodies=t,this._contactMatrix=new Array(t.length);for(var e=0;e<t.length;e++)this._contactMatrix[e]=0},e.prototype.setBallAndNetId=function(t,e,n){this._ballId=t,this._scoreId=e,this._passIdIndex=this._bodies.indexOf(n)},e.prototype.setStarId=function(t){this._starId=t},e.prototype.listenEvent=function(){this._world.on("beginContact",this.contact)},e.prototype.setStatus=function(t){this._status=t,t&&(this._waitEvent=!0);for(var e=0;e<this._contactMatrix.length;e++)this._contactMatrix[e]=0},e}(egret.EventDispatcher);__reflect(WorldEvent.prototype,"WorldEvent");var DoubleScorePage=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.onComplete,e),e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.onComplete=function(t){this.removeEventListener(eui.UIEvent.COMPLETE,this.onComplete,this),this.btnGoHome.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGoHome,this),this.btnWantDoubleScore.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onWatchVideoAd,this)},e.prototype.onGoHome=function(t){Game.instance().gameView.hide()},e.prototype.onWatchVideoAd=function(t){GameAdManager.GetInstance().createRewardedVideoAd("doublescore",function(t){t&&(Account.GetInstance().addItem("doubleScoreTime",1),Account.GetInstance().updateInfo({}))})},e}(eui.Component);__reflect(DoubleScorePage.prototype,"DoubleScorePage",["eui.UIComponent","egret.DisplayObject"]);var GameOverPannel=function(t){function e(){var e=t.call(this)||this;return e.restartGame=function(t){var n=Account.GetInstance().userInfo.resurrectionCard;if(0>=n)WxApi.showModal("复活卡不足");else{var i=Account.GetInstance().userInfo.id;Account.GetInstance().updateReviveCard({id:i+"",type:"-1"},function(t){200==t.stat&&(n--,Account.GetInstance().userInfo.resurrectionCard=n,Game.instance().gameScene.mainGame.continueGame(),Game.instance().gameView.hide())},e)}},e.addEventListener(eui.UIEvent.COMPLETE,e.onComplete,e),e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.onComplete=function(t){this.btnGameAgain.addEventListener(egret.TouchEvent.TOUCH_TAP,this.restartGame,this),this.jumpOutBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Game.instance().gameView.showPage(GameView.PAGE.RESULT);var t=Account.GetInstance().getScore();t>Account.GetInstance().userInfo.topScore&&(Account.GetInstance().updateInfo({topScore:""+t}),WxApi.setUserCloudStorage(t))},this),this.lookVideobtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){WxApi.showModal("暂未开放")},this)},e.prototype.setData=function(){this.resultScoreTxt.text=""+Account.GetInstance().getScore(),this.reviveCntTxt.text="x"+Account.GetInstance().userInfo.resurrectionCard},e}(eui.Component);__reflect(GameOverPannel.prototype,"GameOverPannel",["eui.UIComponent","egret.DisplayObject"]);var GameOverResult=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.init()},e.prototype.init=function(){this.resultScoreTxt.text=""+Account.GetInstance().getScore(),this.listArr=[];for(var t=0;3>t;t++){var e=new egret.Sprite,n=new egret.TextField;n.size=34,n.textColor=6665719,n.text=t+1+"",n.textAlign="center",n.width=100,e.addChild(n);var i=new egret.Sprite;i.x=10,i.y=50,e.addChild(i);var s=new egret.TextField;s.size=34,s.textColor=16213349,s.text="0",s.textAlign="center",s.width=100,s.bold=!0,s.y=150,e.addChild(s),e.x=180*t,this.headGrp.addChild(e),this.listArr.push(e)}this.lookRankBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Game.instance().gameView.showPage(GameView.PAGE.RANK)},this),this.playAgainBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Game.instance().gameView.hide(),Game.instance().gameScene.gotoGame()},this),this.gotoMenuBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Game.instance().gameView.hide(),Game.instance().gameScene.gotoMenu()},this),this.fightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){WxApi.shareAppMessage(2)},this)},e.prototype.setData=function(){var t=this;this.resultScoreTxt.text=""+Account.GetInstance().getScore(),Account.GetInstance().getRank(1,3,function(e){200==e.stat&&t.refreshList(e.data.list)},this)},e.prototype.refreshList=function(t){if(t&&t.length)for(var e=0;3>e;e++){var n=t[e];if(n){this.listArr[e].visible=!0;var i=this.listArr[e].getChildAt(1);if(i.removeChildren(),utils.isUrl(n.avatarUrl)){var s=utils.createBitmapByUrl(n.avatarUrl);s.width=80,s.height=80,i.addChild(s)}this.listArr[e].getChildAt(2).text=n.topScore}else this.listArr[e].visible=!1}},e}(eui.Component);__reflect(GameOverResult.prototype,"GameOverResult",["eui.UIComponent","egret.DisplayObject"]);var GuideScene=function(t){function e(){var e=t.call(this)||this;return e.startGame=function(t){Game.instance().gameScene.gotoGame()},e.onRank=function(t){Game.instance().gameView.showPage(GameView.PAGE.RANK)},e.onMute=function(t){SoundManager.instance().stopAll()},e.onGroupRank=function(t){WxApi.shareAppMessage()},e.onSkin=function(t){Game.instance().gameView.showPage(GameView.PAGE.TIPS)},e.onDoubleScore=function(t){Game.instance().gameView.showPage(GameView.PAGE.DOUBLESCORE)},e.onRevive=function(t){Game.instance().gameView.showPage(GameView.PAGE.REVIVE)},e.addEventListener(eui.UIEvent.COMPLETE,e.onComplete,e),e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.width=egret.MainContext.instance.stage.stageWidth,this.height=egret.MainContext.instance.stage.stageHeight;var e=WxApi.getSystemInfoSync(),n=Game.instance().gameStage.stageHeight;n>e.windowHeight&&(this.justbg.height=e.windowHeight*this.width/e.windowWidth,this.height=this.justbg.height)},e.prototype.onComplete=function(t){this.removeEventListener(eui.UIEvent.COMPLETE,this.onComplete,this),this.btnDoubleScore.visible=!1,this.labelDoubleScore.visible=!1,GameAdManager.GetInstance().createBannerAd(),this.btnStartGame.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this),this.btnRank.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRank,this),this.btnMute.addEventListener(eui.UIEvent.CHANGE,this.onMute,this),this.btnGroupRank.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGroupRank,this),this.btnSkin.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onSkin,this),this.btnDoubleScore.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onDoubleScore,this),this.btnRevive.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onRevive,this),this.labelReviveCard.touchEnabled=!1,Account.GetInstance().getInfo(this.receiveAccountInfo.bind(this))},e.prototype.receiveAccountInfo=function(t){t?this.setSuccessBackInfo():WxApi.getSetting()},e.prototype.setSuccessBackInfo=function(){var t=this,e=WxApi.getLaunchOptionsSync();console.log("启动参数：%o:",e),e&&e.query&&e.query.shareId?(Account.GetInstance().updateReviveCard({id:e.query.shareId,type:"1"}),Account.GetInstance().updateReviveCard({id:Account.GetInstance().userInfo.id,type:"1"},function(e){if(console.log("领卡结果:%o",e),200==e.stat){var n=Account.GetInstance().userInfo.resurrectionCard;Account.GetInstance().userInfo.resurrectionCard=n+1,t.setData()}},this)):this.setData();var n=platform.openDataContext;n.postMessage({command:"init",openid:Account.GetInstance().openId}),WxApi.showShareMenu();var i=Account.GetInstance().userInfo;console.log("这是我的userinfo %o:",i)},e.prototype.setData=function(){var t=Account.GetInstance().userInfo;t?(this.labelDoubleScore.text="剩余"+t.doubleScoreTime+"次",this.labelReviveCard.text="("+t.resurrectionCard+"/5)"):(this.labelDoubleScore.text="剩余0次",this.labelReviveCard.text="(0/5)")},e}(eui.Component);__reflect(GuideScene.prototype,"GuideScene",["eui.UIComponent","egret.DisplayObject"]);var RankItem=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.rankTxt=new egret.TextField,this.rankTxt.textColor=6665719,this.rankTxt.textAlign="center",this.rankTxt.size=24,this.rankTxt.text="1",this.rankTxt.width=60,this.rankTxt.y=30,this.addChild(this.rankTxt),this.headImg=new egret.Sprite,this.headImg.x=80,this.headImg.y=5,this.addChild(this.headImg),this.nickName=new egret.TextField,this.nickName.textColor=10592673,this.nickName.size=24,this.nickName.text="silence",this.nickName.x=200,this.nickName.y=30,this.addChild(this.nickName),this.scoreTxt=new egret.TextField,this.scoreTxt.textColor=10592673,this.scoreTxt.textAlign="center",this.scoreTxt.size=24,this.scoreTxt.text="9999",this.scoreTxt.x=380,this.scoreTxt.y=30,this.scoreTxt.width=100,this.addChild(this.scoreTxt);var t=new egret.Bitmap(RES.getRes("line_png"));t.x=20,t.y=82,t.width=460,this.addChild(t)},e.prototype.setData=function(t){if(this.rankTxt.text=t.rank,this.headImg.removeChildren(),utils.isUrl(t.avatarUrl)){var e=utils.createBitmapByUrl(t.avatarUrl);e.width=70,e.height=70,this.headImg.addChild(e)}this.nickName.text=t.nickname,this.scoreTxt.text=t.topScore},e}(egret.Sprite);__reflect(RankItem.prototype,"RankItem");var RankPage=function(t){function e(){var e=t.call(this)||this;return e.curPage=1,e.PAGE_SIZE=7,e.curSelect=1,e.openDataContext=platform.openDataContext,e.intervalId=0,e.TOTAL_PAGE=10,e.addEventListener(eui.UIEvent.COMPLETE,e.onComplete,e),e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.onComplete=function(t){this.removeEventListener(eui.UIEvent.COMPLETE,this.onComplete,this),this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGoHome,this),this.radioGrp=new eui.RadioButtonGroup,this.radioGrp.addEventListener(eui.UIEvent.CHANGE,this.radioChange,this),this.radioBtn1.group=this.radioGrp,this.radioBtn1.value=1,this.radioBtn2.group=this.radioGrp,this.radioBtn2.value=2,this.lastBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.pageHandler,this),this.nextBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.pageHandler,this),this.radioGrp.selectedValue=1,this.curSelect=1,this.createFriendList(),this.worldArr=[],this.worldSprite=new egret.Sprite;for(var e=0;7>e;e++){var n=new RankItem;n.x=0,n.y=e%7*86-10,this.worldSprite.addChild(n),this.worldArr.push(n)}this.ownItem=new RankItem,this.ownItem.x=0,this.ownItem.y=764,this.worldSprite.addChild(this.ownItem),this.ownItem.setData(Account.GetInstance().userInfo)},e.prototype.createFriendList=function(){var t=this;egret.clearInterval(this.intervalId),this.intervalId=egret.setInterval(function(){t.openDataContext.postMessage({command:"friend",page:t.curPage});var e=t.openDataContext.createDisplayObject(null,Game.instance().gameStage.stageWidth,Game.instance().gameStage.stageHeight);e.x=20,e.y=-10,t.listGrp.removeChildren(),t.listGrp.addChild(e)},this,40)},e.prototype.onGoHome=function(t){egret.clearInterval(this.intervalId),Game.instance().gameView.hide(),Game.instance().gameScene.gotoMenu()},e.prototype.radioChange=function(t){var e=t.target;this.curSelect=e.selectedValue,this.showPageList()},e.prototype.pageHandler=function(t){var e=this.curPage;if(t.target==this.lastBtn){if(1>=e)return;e--}else{if(t.target!=this.nextBtn)return;e++}this.curPage=e,this.showPageList(e)},e.prototype.showPageList=function(t){if(void 0===t&&(t=1),this.listGrp.removeChildren(),1==this.curSelect)this.createFriendList();else if(2==this.curSelect){if(egret.clearInterval(this.intervalId),this.curPage>this.TOTAL_PAGE)return;Account.GetInstance().getRank(this.curPage,this.PAGE_SIZE,this.receiveRankData,this)}},e.prototype.updateWorldRank=function(t){if(t&&0!=t.length){for(var e=this.worldArr.length,n=0;e>n;n++){var i=t[n];i?(this.worldArr[n].visible=!0,this.worldArr[n].setData(i)):this.worldArr[n].visible=!1}this.listGrp.addChild(this.worldSprite)}},e.prototype.receiveRankData=function(t){200==t.stat&&(this.TOTAL_PAGE=t.data.pages,this.updateWorldRank(t.data.list))},e}(eui.Component);__reflect(RankPage.prototype,"RankPage",["eui.UIComponent","egret.DisplayObject"]);var RevivePromotion=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.onComplete,e),e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.onComplete=function(t){this.removeEventListener(eui.UIEvent.COMPLETE,this.onComplete,this),this.btnGoHome.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGoHome,this),this.btnWantReviveCard.addEventListener(egret.TouchEvent.TOUCH_TAP,this.shareClk,this)},e.prototype.onGoHome=function(t){Game.instance().gameView.hide(),Game.instance().gameScene.gotoMenu()},e.prototype.shareClk=function(t){WxApi.shareAppMessage(1)},e}(eui.Component);__reflect(RevivePromotion.prototype,"RevivePromotion",["eui.UIComponent","egret.DisplayObject"]);var ScorePanel=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.onComplete,e),e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.onComplete=function(t){this.labelDoubleTimes.visible=!1,this.removeEventListener(eui.UIEvent.COMPLETE,this.onComplete,this)},e.prototype.setScore=function(t){this.labelScore.text=""+t},e.prototype.setDoubleTimes=function(t){this.labelDoubleTimes.text="双倍剩余次数:"+t.toString()},e}(eui.Component);__reflect(ScorePanel.prototype,"ScorePanel",["eui.UIComponent","egret.DisplayObject"]);var SkinPage=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.onComplete,e),e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.onComplete=function(t){this.removeEventListener(eui.UIEvent.COMPLETE,this.onComplete,this),this.btnGoHome.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onGoHome,this)},e.prototype.onGoHome=function(t){Game.instance().gameScene.gotoMenu()},e}(eui.Component);__reflect(SkinPage.prototype,"SkinPage",["eui.UIComponent","egret.DisplayObject"]);var StarPanel=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(eui.UIEvent.COMPLETE,e.onComplete,e),e}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this)},e.prototype.onComplete=function(t){this.removeEventListener(eui.UIEvent.COMPLETE,this.onComplete,this)},e.prototype.setStarNum=function(t){this.labelStarNum.text=t.toString()},e}(eui.Component);__reflect(StarPanel.prototype,"StarPanel",["eui.UIComponent","egret.DisplayObject"]);var TipsPage=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.partAdded=function(e,n){t.prototype.partAdded.call(this,e,n)},e.prototype.childrenCreated=function(){t.prototype.childrenCreated.call(this),this.goodBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){Game.instance().gameView.hide()},this)},e}(eui.Component);__reflect(TipsPage.prototype,"TipsPage",["eui.UIComponent","egret.DisplayObject"]);var AccountApi=function(){function t(){}return t.initUserInfo=function(t){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(i){return e=Constants.BaseUrl+"/userInfo/addUserInfo",n={},Object.keys(t).forEach(function(e){n[e]=t[e]}),[2,new Promise(function(t,i){try{NetUtils.put(e,n,t)}catch(s){i(s)}})]})})},t.getWxOpenId=function(t,e,n,i){return __awaiter(this,void 0,void 0,function(){var s,o;return __generator(this,function(a){return s=Constants.BASE_IP+"gameBox/game/getJscode2session/js_code/"+t+"/secret/"+e+"/appid/"+n+"/grant_type/"+i,o={},[2,new Promise(function(t,e){try{NetUtils.get(s,function(n){200==n.stat?(n.data=JSON.parse(n.data),t(n.data.openid?n.data.openid:"")):e(n.stat)})}catch(n){e(500)}})]})})},t.getUserInfoByOpenId=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){return e=Constants.BaseUrl+"/userInfo/getUserInfoByThirdid/thirdid/"+t.toString(),[2,new Promise(function(t,n){try{NetUtils.get(e,function(e){200==e.stat?t(e.data):n(e.stat)})}catch(i){n(500)}})]})})},t.getUserInfo=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){return e=Constants.BaseUrl+"/userInfo/getUserInfoById/id/"+t.toString(),[2,new Promise(function(t,n){try{NetUtils.get(e,t)}catch(i){n(i)}})]})})},t.updateUserInfo=function(t){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(i){return e=Constants.BaseUrl+"/userInfo/updateUserInfo",n=t,[2,new Promise(function(t,i){try{NetUtils.put(e,n,t)}catch(s){i(s)}})]})})},t.getRank=function(t){return __awaiter(this,void 0,void 0,function(){var e,n;return __generator(this,function(i){return e=Constants.BaseUrl+"/userInfo/getTopScoreRankInAll"+t,n={},[2,new Promise(function(t,n){try{NetUtils.get(e,t)}catch(i){n(i)}})]})})},t.updateReviveCard=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){return e=Constants.BaseUrl+"/userInfo/updateResurrectionCard"+t,[2,new Promise(function(t,n){try{NetUtils.get(e,t)}catch(i){n(i)}})]})})},t}();__reflect(AccountApi.prototype,"AccountApi");var GameAdManager=function(){function t(){this._bannerAd=null,this.isWxGame=!1,"wxgame"==egret.Capabilities.runtimeType&&(this.isWxGame=!0)}return t.GetInstance=function(){return null==t._instance&&(t._instance=new t),t._instance},t.prototype.createBannerAd=function(){if(console.log("==========createBannerAd: %j, %j",egret.Capabilities.runtimeType,utils.isWxGame),this.isWxGame){console.log("==========createBannerAd true");var t=wx.getSystemInfoSync();console.log("==========createBannerAd :%j",t),this._bannerAd=wx.createBannerAd({adUnitId:"banner",style:{left:10,top:t.screenHeight-300,width:t.screenWidth-20}}),this._bannerAd.show()}},t.prototype.updateBannerAd=function(){if(this.isWxGame){if(!this._bannerAd)return void this.createBannerAd();this._bannerAd.destory(),this.createBannerAd()}},t.prototype.createRewardedVideoAd=function(t,e){if(this.isWxGame){var n=wx.createRewardedVideoAd({adUnitId:t});n.show()["catch"](function(t){n.load().then(function(){return n.show()})}),n.onClose(function(t){e(t&&t.isEnded||void 0===t?!0:!1)})}},t._instance=null,t}();__reflect(GameAdManager.prototype,"GameAdManager");var WxApi=function(){function t(){}return t.getSetting=function(){wx.getSetting({complete:function(e){if("getSetting:ok"==e.errMsg){var n=e.authSetting;1==n["scope.userInfo"]?wx.getUserInfo({success:function(t){Account.GetInstance().setInfo(t.userInfo),Game.instance().gameScene.menuScene.setSuccessBackInfo()
}}):t.createUserInfoButton(),console.log("getSetting:%o",e)}else wx.showModal(e.errMsg)}})},t.createUserInfoButton=function(e,n,i,s){if(void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=Game.instance().gameStage.stageWidth),void 0===s&&(s=Game.instance().gameStage.stageHeight),"wxgame"==egret.Capabilities.runtimeType){var o=wx.createUserInfoButton({type:"text",text:"",style:{left:e,top:n,width:i,height:s,backgroundColor:"#000000",color:"#ffffff",textAlign:"center",fontSize:16,opacity:.1}});o.onTap(function(e){"getUserInfo:ok"==e.errMsg&&(o.hide(),o.destroy(),t.showShareMenu(),Account.GetInstance().setInfo(e.userInfo),Game.instance().gameScene.menuScene.setSuccessBackInfo())})}},t.showShareMenu=function(){t.shareToFriend(),wx.showShareMenu({withShareTicket:!1,complete:function(t){console.log(t.errMsg)}})},t.shareToFriend=function(){wx.onShareAppMessage(function(){return{title:"天天向上投",imageUrl:"resource/assets/basketball/shareImage.png",query:"shareId="+Account.GetInstance().userInfo.id}})},t.shareAppMessage=function(t){void 0===t&&(t=0);var e="";0==t?e="有人@你，快进来看看你能排第几？":1==t?e="有人@你，挑战绣球大神，你能排第几?":2==t&&(e="有人挑战你，我投了__分，你能超过我吗？"),wx.shareAppMessage({title:e,imageUrl:"resource/assets/basketball/shareImage.png",query:"shareId="+Account.GetInstance().userInfo.id})},t.setUserCloudStorage=function(t){var e=window.wx;e.setUserCloudStorage({KVDataList:[{key:"score",value:""+t}],success:function(t){console.log(t)}})},t.getLaunchOptionsSync=function(){var t=wx.getLaunchOptionsSync();return t},t.showModal=function(t){wx.showModal({title:"提示",content:t,showCancel:!1,cancelText:"",confirmText:"确定"})},t.getSystemInfoSync=function(){var t=window.wx;return t.getSystemInfoSync()},t}();__reflect(WxApi.prototype,"WxApi");var JsonpReq=function(){function t(){}return t.process=function(e,n,i){t.completeCall["call_"+t._regID]=n.bind(i),t.startLoader(e,t._regID++)},t.startLoader=function(t,e){var n=document.createElement("script");n.src=t+"JsonpReq.completeCall.call_"+e,document.body.appendChild(n)},t._regID=0,t.completeCall={},t}();__reflect(JsonpReq.prototype,"JsonpReq");var NetUtils=function(){function t(){}return t.ListenEvent=function(t,e){t.addEventListener(egret.Event.COMPLETE,function(t){var n=t.currentTarget,i=n.response;e&&e(JSON.parse(i))},null),t.addEventListener(egret.IOErrorEvent.IO_ERROR,function(t){e&&e(t)},null)},t.get=function(e,n){var i=new egret.HttpRequest;i.responseType=egret.HttpResponseType.TEXT,i.open(e,egret.HttpMethod.GET),i.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),i.send(),t.ListenEvent(i,n)},t.post=function(e,n,i){var s=utils.queryString(n),o=new egret.HttpRequest;o.responseType=egret.HttpResponseType.TEXT,o.open(e,egret.HttpMethod.POST),o.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),o.send(s),t.ListenEvent(o,i)},t.put=function(e,n,i){var s=JSON.stringify(n),o=new egret.HttpRequest;o.responseType=egret.HttpResponseType.TEXT,o.open(e,egret.HttpMethod.POST),o.setRequestHeader("Content-Type","application/json"),o.send(s),t.ListenEvent(o,i)},t}();__reflect(NetUtils.prototype,"NetUtils");var utils=function(){function t(){}return t.isNullOrUndefined=function(t){return"undefined"==typeof t||null===t},t.trim=function(t,e){return""},t.queryString=function(e){if(e){var n="";for(var i in e)e.hasOwnProperty(i)&&(n+=i+"="+e[i].toString()+"&");return t.trim(n,"&")}},t.createBitmapByName=function(t){var e=new egret.Bitmap,n=RES.getRes(t);return e.texture=n,e},t.createBitmapByUrl=function(t){egret.ImageLoader.crossOrigin="anonymous";var e=new egret.ImageLoader,n=new egret.Bitmap;return e.addEventListener(egret.Event.COMPLETE,function(t){var e=t.currentTarget,i=new egret.Texture;i._setBitmapData(e.data),n.$setTexture(i)},this),e.load(t),n},t.createBox=function(t,e,n){void 0===n&&(n=16773120);var i=new egret.Shape;return i.graphics.beginFill(n),i.graphics.drawRect(0,0,t,e),i.graphics.endFill(),i},t.createPolygon=function(t){if(t.length<=1)return null;var e=.8,n=new egret.Shape;n.graphics.lineStyle(3,16773120),n.graphics.moveTo(t[0][0]*e,t[0][1]*e);for(var i=1;i<t.length;i++)n.graphics.lineTo(t[i][0]*e,t[i][1]*e);return n.graphics.endFill(),n},t.createBall=function(t,e){var n=new egret.Shape;return e?n.graphics.beginFill(e):n.graphics.beginFill(16773120),n.graphics.drawCircle(t,t,t),n.graphics.endFill(),n},t.p2PointToStage=function(t,e){return e||(e=new egret.Point(0,0)),e.x=t.x*Constants.FACTOR,e.y=egret.MainContext.instance.stage.stageHeight-t.y*Constants.FACTOR,e},t.p2PosToStage=function(t,e,n){return n||(n=new egret.Point(0,0)),n.x=t*Constants.FACTOR,n.y=egret.MainContext.instance.stage.stageHeight-e*Constants.FACTOR,n},t.stagePointToP2=function(t,e){return e||(e=new egret.Point(0,0)),e.x=t.x/Constants.FACTOR,e.y=(egret.MainContext.instance.stage.stageHeight-t.y)/Constants.FACTOR,e},t.distance=function(t,e,n,i){return Math.sqrt(Math.pow(n-t,2)+Math.pow(i-e,2))},t.angle=function(t,e,n,i){var s=n-t,o=i-e,a=0>o?180:0;return 0>s?(a=180/Math.PI*Math.atan(Math.abs(s/o)),0>o&&(a=180-a)):s>0&&(a=-(180/Math.PI)*Math.atan(Math.abs(s/o)),0>o&&(a=-(180+a))),a},t.isUrl=function(t){if(!t||""==t)return!1;var e=/^((ht|f)tps?):\/\/[\w\-]+(\.[\w\-]+)+([\w\-\.,@?^=%&:\/~\+#]*[\w\-\@?^=%&\/~\+#])?$/;return 1==e.test(t)?!0:!1},t.runtime=egret.Capabilities.runtimeType,t.isWxGame="wxgame"==egret.Capabilities.runtimeType?!0:!1,t}();__reflect(utils.prototype,"utils"),window.Main=Main;